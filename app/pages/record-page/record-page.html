<!-- Copyright (c) 2016 Tracktunes Inc -->

<ion-header>
    <ion-navbar no-border-bottom almost-dark>
        <button menuToggle>
            <ion-icon name="menu"></ion-icon>
        </button>
        <ion-title>Record</ion-title>
        <ion-buttons end *ngIf="recorderIsReady() && gainFactor !== 0">
            <button small (click)="webAudioRecorder.resetPeaks()">
            <ion-badge darkest-gray item-right>
                {{webAudioRecorder.percentPeaksAtMax}}% peaks
            </ion-badge>
        </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>

<ion-content padding>
    <vu-gauge height="2.5em" nbars="55" [value]="webAudioRecorder.currentVolume" [max]="webAudioRecorder.maxVolumeSinceReset">
    </vu-gauge>
    <p class="gain-item-label">
        Gain: {{percentGain}}% ({{decibels}})
        <button small almost-dark (click)="onResetGain()">Reset Gain</button>
    </p>
    <!-- version with icons: has the following two icons inside <ion-range>:
        <ion-icon range-left small name="mic-off"></ion-icon>
        <ion-icon range-right name="mic"></ion-icon>                 -->
    <!-- this works: ion-range light (ionChange)="onGainChange($event.value)" debounce="50" (touchend)="onRangeTouchEnd()">
    </ion-range>-->
    <!-- this does not work, fails phantomjs test: ion-range light [(ngModel)]="gainRangeSliderValue" (ionChange)="onGainChange($event.value)" debounce="50" (touchend)="onRangeTouchEnd()">
    </ion-range-->
    <progress-slider [progress]="gainFactor/maxGainFactor" (change)="onGainChange($event)" (changeEnd)="onGainChangeEnd($event)">
    </progress-slider>

    <div class="recording-time">
        {{webAudioRecorder.currentTime}}
    </div>
    <div class="record-upload-buttons">
        <button logo-red [disabled]="!recorderIsReady()" (click)="onClickStartPauseButton()">
            <ion-icon [name]="recordButtonIcon">
            </ion-icon>
        </button>
        <button logo-orange [disabled]="!recorderIsReady() || webAudioRecorder.isInactive" (click)="onClickStopButton()">
            <ion-icon name="square">
            </ion-icon>
        </button>
    </div>
</ion-content>